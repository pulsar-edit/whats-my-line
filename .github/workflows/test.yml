name: Test

on:
  pull_request:
  push:
    branches: [ 'master' ]

jobs:
  test:
    strategy:
      matrix:
        os: [ ubuntu-latest, macos-latest, windows-latest, windows-2019 ]
        node-version: [ 16, 18 ]
      fail-fast: false
    name: Test
    runs-on: ${{ matrix.os }}
    steps:
    - name: Checkout the latest code
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
        # Make sure we get all commits, since testing uses the local git info
    - name: Setup Node
      uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
    - name: Globally install node-gyp for Yarn
      # Workaround for a weird Yarn v1.x issue,
      # which only happens when global npm is v9.7.2 or newer.
      run: yarn global add node-gyp@9.4.0
    - name: Install Dependencies with Yarn
      run: yarn install
    - name: Run Tests
      run: npm run test
